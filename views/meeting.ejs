<div id="main-content">
  <h3>Meeting <strong><%= meeting.name %></strong></h3>
  <div id="total">â‚¬<span id="meetingTotalValue"><%= meeting.total %></span></span></div>

  <div id="form-join" class="form-inline">
    <h5 id="join-this-meeting-question">Join this meeting?</h5>
  	<span><input type="text" autocomplete="off" placeholder="Price per Hour..." id="attendee-rate" title="What is the cost of an hour of your time?"></span>
    <span><a id="attendee-join" class="btn btn-inverse">Join</a></span>
  </div>
  <div>

  <div id="form-leave" class="form-inline hidden">
  	<span><a id="attendee-leave" class="btn btn-inverse">Leave</a></span>
  </div>
</div>
	
<script src="/js/counter.js"></script>

<script>
$(function() {
	
	var counter = new Meetoring.Counter('#meetingTotalValue', 200);
  var meeting = <%- JSON.stringify(meeting) %>;
  counter.init(meeting);
	counter.start();
	
	var sync = function(data) {
		meeting = data;
		counter.restart(meeting);
	};
	
	var socket = io.connect();
	socket.on('sync', sync);

	var rate = 0;
	var action = function(event, fn) {
		socket.emit(event, { rate: rate, meetingId: meeting.id }, function(data) {
			sync(data);
			if (fn) fn();
		});
	};
	
	$('#attendee-join').click(function(event){ 
		rate =  $("#attendee-rate").attr('value');

		action('join', function(data) {
			$("#form-join").hide();
			$("#form-leave").removeClass('hidden').show();
		});
	});
	
	$('#attendee-leave').click(function(event){ 
		action('leave', function(data) {
			$("#form-leave").hide();
			$("#form-join").show();
		});
	});
	
	setInterval(function() { socket.emit('syncRequest', meeting.id, sync); }, 5 * 1000);
	
	$('#attendee-rate').tooltip();
	$("#attendee-rate").keyup(function(event){
      if(event.keyCode == 13){
          $("#attendee-join").click();
      }
  });
});
</script>